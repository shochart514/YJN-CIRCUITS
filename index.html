<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Restrictions CYJN</title>
  <style>
    body {
      font-family: sans-serif;
      text-align: center;
      padding: 20px;
      margin: 0;
    }

    h1 {
      font-size: 1.8rem;
      margin-bottom: 1.2rem;
    }

    .status {
      font-size: 1.4rem;
      padding: 1rem;
      margin: 1rem auto;
      max-width: 90%;
      border-radius: 10px;
    }

    .green { background: #c8f7c5; color: #145214; }
    .orange { background: #ffe3b3; color: #9e6100; }
    .red { background: #f8caca; color: #9e0000; }

    label, select, input, button {
      font-size: 1.1rem;
      margin: 0.5rem;
      padding: 0.4rem;
      width: 90%;
      max-width: 400px;
      display: block;
      margin-left: auto;
      margin-right: auto;
      box-sizing: border-box;
    }

    button {
      cursor: pointer;
    }

    @media (min-width: 600px) {
      h1 {
        font-size: 2rem;
      }

      .status {
        font-size: 1.6rem;
      }

      label, select, input, button {
        font-size: 1.2rem;
      }
    }
  </style>
</head>
<body>
  <h1>Statut des posés-décollés à CYJN</h1>

  <label for="mode">Mode :</label>
  <select id="mode" onchange="onModeChange()">
    <option value="real">Temps réel</option>
    <option value="custom">Date/heure personnalisée</option>
  </select>

  <div id="customTimeControls" style="display: none;">
    <label for="customDateTime">Sélectionnez une date et une heure :</label>
    <input type="datetime-local" id="customDateTime" onchange="updateDashboardFromInput()">
  </div>

  <div id="restrictionDescription" class="status"></div>
  <div id="currentStatus" class="status"></div>

  <script>
    const quebecHolidays2025 = [
      "2025-01-01", "2025-04-18", "2025-04-21", "2025-05-19", "2025-06-24",
      "2025-07-01", "2025-09-01", "2025-09-30", "2025-10-13", "2025-11-11",
      "2025-12-25", "2025-12-26"
    ];

    // ⬇️ Starting Sunday for "un dimanche sur deux"
    const firstActiveSunday = new Date(2025, 3, 13); // April 13, 2025 (month is 0-indexed)

    let autoRefreshInterval = null;

    function formatDateKey(date) {
      return date.toISOString().split("T")[0];
    }

    function isBetween(date, startMonth, startDay, endMonth, endDay) {
      const year = date.getFullYear();
      const start = new Date(year, startMonth - 1, startDay);
      const end = new Date(year, endMonth - 1, endDay);
      return date >= start && date <= end;
    }

    function isEvenSunday(date) {
      const oneWeekMs = 7 * 24 * 60 * 60 * 1000;
      const diffWeeks = Math.floor((date - firstActiveSunday) / oneWeekMs);
      return diffWeeks % 2 === 0;
    }

    function getRestrictions(today) {
      const dateKey = formatDateKey(today);
      const day = today.getDay();
      const hour = today.getHours();
      const minutes = today.getMinutes();
      const time = hour + minutes / 60;

      const isRestrictedSeason = isBetween(today, 5, 1, 10, 15);
      const isHoliday = quebecHolidays2025.includes(dateKey);

      if (isRestrictedSeason && isHoliday) {
        return {
          message: "Aujourd'hui est un jour férié au Québec, durant la période de restriction. Les circuits sont interdits toute la journée.",
          color: "orange",
          current: true
        };
      }

      if (!isRestrictedSeason) {
        return {
          message: "Aucune restriction aujourd'hui (hors période du 1er mai au 15 octobre).",
          color: "green",
          current: false
        };
      }

      if (day >= 1 && day <= 4) {
        const current = (time < 8 || time > 22);
        return {
          message: "Aujourd'hui, les circuits sont interdits avant 8 h et après 22 h.",
          color: "orange",
          current
        };
      }

      if (day === 5 || day === 6) {
        const current = (time < 8 || time > 17);
        return {
          message: "Aujourd'hui, les circuits sont interdits avant 8 h et après 17 h.",
          color: "orange",
          current
        };
      }

      if (day === 0 && isBetween(today, 7, 1, 8, 15)) {
        return {
          message: "Aujourd'hui (dimanche entre le 1er juillet et le 15 août), les circuits sont interdits toute la journée.",
          color: "orange",
          current: true
        };
      }

      if (day === 0 && (isBetween(today, 5, 1, 6, 30) || isBetween(today, 8, 16, 10, 15))) {
        if (isEvenSunday(today)) {
          const current = (time < 10 || time > 17);
          return {
            message: "Aujourd'hui est un dimanche autorisé pour les circuits, mais seulement entre 10 h et 17 h.",
            color: "orange",
            current
          };
        } else {
          return {
            message: "Aujourd'hui est un dimanche sans circuits (1 dimanche sur 2).",
            color: "orange",
            current: true
          };
        }
      }

      return {
        message: "Aucune restriction aujourd'hui.",
        color: "green",
        current: false
      };
    }

    function updateDashboard(dateOverride = null) {
      const now = dateOverride || new Date();
      const restriction = getRestrictions(now);

      const descEl = document.getElementById("restrictionDescription");
      descEl.textContent = `AUJOURD'HUI : ${restriction.message}`;
      descEl.className = `status ${restriction.color}`;

      const currentEl = document.getElementById("currentStatus");
      if (restriction.color === "green") {
        currentEl.textContent = "✅ Les circuits sont permis en ce moment.";
        currentEl.className = "status green";
      } else if (restriction.current) {
        currentEl.textContent = "⛔️ Les circuits sont INTERDITS en ce moment.";
        currentEl.className = "status red";
      } else {
        currentEl.textContent = "✅ Les circuits sont permis en ce moment.";
        currentEl.className = "status green";
      }
    }

    function updateDashboardFromInput() {
      const input = document.getElementById("customDateTime").value;
      if (input) {
        const selectedDate = new Date(input);
        updateDashboard(selectedDate);
      }
    }

    function onModeChange() {
      const mode = document.getElementById("mode").value;
      const customControls = document.getElementById("customTimeControls");

      if (mode === "real") {
        customControls.style.display = "none";
        updateDashboard();
        startAutoRefresh();
      } else {
        customControls.style.display = "block";
        stopAutoRefresh();
        updateDashboardFromInput();
      }
    }

    function startAutoRefresh() {
      if (autoRefreshInterval) clearInterval(autoRefreshInterval);
      autoRefreshInterval = setInterval(updateDashboard, 60 * 1000);
    }

    function stopAutoRefresh() {
      if (autoRefreshInterval) {
        clearInterval(autoRefreshInterval);
        autoRefreshInterval = null;
      }
    }

    // Initial load
    updateDashboard();
    startAutoRefresh();
  </script>
</body>
</html>
