<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="UTF-8">
  <title>Restrictions CYJN</title>
  <style>
    body {
      font-family: sans-serif;
      text-align: center;
      padding: 40px;
    }
    .status {
      font-size: 2rem;
      padding: 20px;
      margin: 20px auto;
      max-width: 800px;
      border-radius: 10px;
    }
    .green { background: #c8f7c5; color: #145214; }
    .orange { background: #ffe3b3; color: #9e6100; }
    .red { background: #f8caca; color: #9e0000; }
    label, input, button, select {
      font-size: 1.1rem;
      margin: 10px;
    }
  </style>
</head>
<body>
  <h1>Statut des pos√©s-d√©coll√©s √† CYJN</h1>

  <!-- Mode selector -->
  <div>
    <label for="mode">Mode :</label>
    <select id="mode" onchange="onModeChange()">
      <option value="real">Temps r√©el</option>
      <option value="custom">Date/heure personnalis√©e</option>
    </select>
  </div>

  <!-- Custom time input -->
  <div id="customTimeControls" style="display: none;">
    <label for="customDateTime">S√©lectionnez une date et une heure :</label>
    <input type="datetime-local" id="customDateTime" onchange="updateDashboardFromInput()">
  </div>

  <div id="restrictionDescription" class="status"></div>
  <div id="currentStatus" class="status"></div>

  <script>
    // List of Qu√©bec holidays in 2025
    const quebecHolidays2025 = [
      "2025-01-01", "2025-04-18", "2025-04-21", "2025-05-19", "2025-06-24",
      "2025-07-01", "2025-09-01", "2025-09-30", "2025-10-13", "2025-11-11",
      "2025-12-25", "2025-12-26"
    ];

    // üü® CONFIG: First Sunday of "un dimanche sur deux" (active Sunday)
    const firstActiveSunday = new Date(2025, 4, 4); // May 4, 2025 (month is 0-indexed)

    let autoRefreshInterval = null;

    function formatDateKey(date) {
      return date.toISOString().split("T")[0];
    }

    function isBetween(date, startMonth, startDay, endMonth, endDay) {
      const year = date.getFullYear();
      const start = new Date(year, startMonth - 1, startDay);
      const end = new Date(year, endMonth - 1, endDay);
      return date >= start && date <= end;
    }

    function isEvenSunday(date) {
      const oneWeekMs = 7 * 24 * 60 * 60 * 1000;
      const diffWeeks = Math.floor((date - firstActiveSunday) / oneWeekMs);
      return diffWeeks % 2 === 0;
    }

    function getRestrictions(today) {
      const dateKey = formatDateKey(today);
      const day = today.getDay(); // 0 = Sunday
      const hour = today.getHours();
      const minutes = today.getMinutes();
      const time = hour + minutes / 60;

      const isRestrictedSeason = isBetween(today, 5, 1, 10, 15);
      const isHoliday = quebecHolidays2025.includes(dateKey);

      if (isRestrictedSeason && isHoliday) {
        return {
          message: "Aujourd'hui est un jour f√©ri√© au Qu√©bec, durant la p√©riode de restriction. Les circuits sont interdits toute la journ√©e.",
          color: "orange",
          current: true
        };
      }

      if (!isRestrictedSeason) {
        return {
          message: "Aucune restriction aujourd'hui (hors p√©riode du 1er mai au 15 octobre).",
          color: "green",
          current: false
        };
      }

      // Monday to Thursday
      if (day >= 1 && day <= 4) {
        const current = (time < 8 || time > 22);
        return {
          message: "Aujourd'hui, les circuits sont interdits avant 8 h et apr√®s 22 h.",
          color: "orange",
          current
        };
      }

      // Friday and Saturday
      if (day === 5 || day === 6) {
        const current = (time < 8 || time > 17);
        return {
          message: "Aujourd'hui, les circuits sont interdits avant 8 h et apr√®s 17 h.",
          color: "orange",
          current
        };
      }

      // Sunday July 1 ‚Äì Aug 15
      if (day === 0 && isBetween(today, 7, 1, 8, 15)) {
        return {
          message: "Aujourd'hui (dimanche entre le 1er juillet et le 15 ao√ªt), les circuits sont interdits toute la journ√©e.",
          color: "orange",
          current: true
        };
      }

      // Sunday May‚ÄìJune & Aug 16‚ÄìOct 15 (every other Sunday)
      if (day === 0 && (isBetween(today, 5, 1, 6, 30) || isBetween(today, 8, 16, 10, 15))) {
        if (isEvenSunday(today)) {
          const current = (time < 10 || time > 17);
          return {
            message: "Aujourd'hui est un dimanche autoris√© pour les circuits, mais seulement entre 10 h et 17 h.",
            color: "orange",
            current
          };
        } else {
          return {
            message: "Aujourd'hui est un dimanche sans circuits (1 dimanche sur 2).",
            color: "orange",
            current: true
          };
        }
      }

      return {
        message: "Aucune restriction aujourd'hui.",
        color: "green",
        current: false
      };
    }

    function updateDashboard(dateOverride = null) {
      const now = dateOverride || new Date();
      const restriction = getRestrictions(now);

      const descEl = document.getElementById("restrictionDescription");
      descEl.textContent = `AUJOURD'HUI : ${restriction.message}`;
      descEl.className = `status ${restriction.color}`;

      const currentEl = document.getElementById("currentStatus");
      if (restriction.color === "green") {
        currentEl.textContent = "‚úÖ Les circuits sont permis en ce moment.";
        currentEl.className = "status green";
      } else if (restriction.current) {
        currentEl.textContent = "‚õîÔ∏è Les circuits sont INTERDITS en ce moment.";
        currentEl.className = "status red";
      } else {
        currentEl.textContent = "‚úÖ Les circuits sont permis en ce moment.";
        currentEl.className = "status green";
      }
    }

    function updateDashboardFromInput() {
      const input = document.getElementById("customDateTime").value;
      if (input) {
        const selectedDate = new Date(input);
        updateDashboard(selectedDate);
      }
    }

    function onModeChange() {
      const mode = document.getElementById("mode").value;
      const customControls = document.getElementById("customTimeControls");

      if (mode === "real") {
        customControls.style.display = "none";
        updateDashboard();
        startAutoRefresh();
      } else {
        customControls.style.display = "block";
        stopAutoRefresh();
        updateDashboardFromInput();
      }
    }

    function startAutoRefresh() {
      if (autoRefreshInterval) clearInterval(autoRefreshInterval);
      autoRefreshInterval = setInterval(updateDashboard, 60 * 1000);
    }

    function stopAutoRefresh() {
      if (autoRefreshInterval) {
        clearInterval(autoRefreshInterval);
        autoRefreshInterval = null;
      }
    }

    // Initial load
    updateDashboard();
    startAutoRefresh();
  </script>
</body>
</html>
